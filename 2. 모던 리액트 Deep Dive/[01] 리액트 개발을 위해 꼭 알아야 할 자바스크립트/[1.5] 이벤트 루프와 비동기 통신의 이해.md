### 1.5 이벤트 루프와 비동기 통신의 이해

- 동기(synchronous) - 직렬 방식으로 작업을 처리하는 것
- 비동기(asynchronous) - 병렬 방식으로 작업을 처리하는 것
- 자바스크립트는 싱글 스레드 동기 방식으로 작동 → 그러나 다양한 비동기 작업을 수행

  <br/>

1. 싱글 스레드 자바스크립트
- 프로세스(process) - 프로그램을 구동해 프로그램의 상태가 메모리상에서 실행되는 작업 단위
- 프로그램의 실행은 하나의 프로세스를 가지고, 그 내부에서 모든 작업을 처리
    
    → 소프트웨어가 복잡해지면서 **스레드(thread)**라는 더 작은 단위가 탄생
    
- 멀티스레드는 내부적으로 처리가 복잡하다는 단점이 존재.
    - 동시에 같은 자원에 접근한다면? 혹은 수정된다면? → 동시성 문제
    - 하나의 스레드에 문제가 생겼을때, 그 스레드와 자원을 공유하는 다른 스레드에도 영향을 미칠 수 있다.
- 자바스크립트는 왜 싱글스레드?
    
    → 자바스크립트는 HTML의 한계 때문에 만들어짐
    
    - 웹페이지 초반은 정적인 HTML 문서로 구성되어있어 사용자 인터렉션과 동적인 화면 구성에 제한적이었다.  → 자바스크립트 등장
    - 당시의 요구사항은 단순한 처리 정도로 제한적이었기 때문에 멀티스레드가 필요하지 않았음
    - 오히려 멀티스레드가 자바스크립트의 스펙에 번거로운 정도
- 자바스크립트가 싱글스레드라는 것은 자바스크립트 코드의 실행이 하나의 스레드에서 순차적으로 이루어진다는 것을 의미.
    
    → 한 작업이 끝날때 까지 뒤의 작업이 실행되지 않음 (Run-to-completion)
    
    → 하나의 작업이 오래걸린다면 사용자 경험이 좋지 않다. (화면이 멈춘 것 같은 느낌)
    
<br/>

2. 이벤트 루프
   
   **호출 스택과 이벤트 루프**

- 호출스택이 비어있는지 확인하는 것이 이벤트 루프
- 이벤트루프는 단일 스레드 내부에서 호출스택 내부에 실행할 작업이 있는지 확인하고, 자바스크립트 엔진을 이용하여 실행.
- ‘코드를 실행하는 것’과 ‘호출 스택이 비어있는 것’을 단일 스레드에서 확인 → 동시에 일어날 수 없음
- 이벤트 루프는 태스크 큐를  한 개 이상 가지고 있음
    - 태스크 큐: 실행해야 할 태스크의 집합
    - 태스크 큐는 선택된 큐 중에서 가장 오래된 태스크를 가져오기 때문에 큐가 아니라 `set` 형태를 띄고 있다.
    - 실행해야 할 태스크란 비동기 함수의 콜백 함수나 이벤트 핸들러와 같은 것.
- 이벤트 루프의 역할: 호출 스택에 실행 중인 코드가 있는지 ↔ 태스크 큐에 대기중인 함수가 있는지 확인
- 자바스크립트 코드 실행은 싱글 스레드에서 이루어지지만 외부 Web API등 비동기 작업은 백그라운드 작업으로 넘어가서 처리되며, 메인스레드를 차단하지 않는다.
- 비동기 작업이 완료되면 콜백함수가 태스크 큐로 들어가며, 메인 스레드가 비어있을 때 이벤트 루프가 이 콜백을 실행한다.
    
    → 비동기 작업이 백그라운드 작업으로 넘겨져 처리 된 후에 태스크 큐에 콜백으로 들어가는 과정이 자바스크립트의 비동기 프로그래밍을 가능하게 하는 것.

<br/>
<br/>
    
3. 태스크 큐와 마이크로 태스크 큐
- 이벤트 루프는 하나의 마이크로 태스크 큐를 갖음. (대표적으로 `Promise`)
- 마이크로 태스크 큐는 기존 태스크 큐보다 우선권을 갖는다.
- 마이크로 태스크 큐가 빌 때까지는 기존 태스크 큐의 실행은 뒤로 미루어진다.
- 렌더링은 마이크로 태스크 큐가 실행된 후에 실행된다. (마이크로 태스크 큐 - 렌더링 - 태스크 큐)
