### 2.2 가상 DOM과 리액트 파이버

1. DOM 과 브라우저 렌더링 과정
- 브라우저가 사용자가 요청한 주소를 방문해 HTML 파일을 다운로드 한다
- 브라우저의 렌더링 엔진은 HTML를 파싱해 DOM 노드로 구성된 DOM트리를 만든다.
- 이 과정에서 CSS 파일이 있다면 다운로드한다
- 브라우저의 렌더링 엔진이 CSS도 파싱하여 CSS 노드로 구성된 CSSOM 트리를 만든다.
- 브라우저는 파싱된 DOM 노드를 순회하는데, 사용자 눈에 보이는(`display:none`같은 요소 제외) 노드를 방문하여 해당 노드에 대한 CSSOM 정보를 찾아 해당하는 스타일 정보를 적용한다. 이때, CSS 적용하는 과정은 크게 두가지이다.
    - 레이아웃(layout, reflow): 각 노드가 브라우저 화면의 어느 좌표에 나타나야 하는지 계산. **레이아웃 과정을 거치면 반드시 페인팅 과정도 거친다.**
    - 페인팅: 레이아웃 단계를 거친 노드에 색과 같은 실제 유효한 값을 그린다.

<br/>
    
2. 가상DOM 배경
- 브라우저가 웹페이지를 렌더링 하는 과정은 복잡하고 많은 비용이 든다.
- 렌더링 이후에도 사용자의 인터랙션으로 웹페이지가 변경되는 상황도 고려해야한다.  → 빈번한 DOM 업데이트가 요구됨 → 부담비용 상승
- 가상 DOM은 웹페이지가 표시해야할 DOM을 일단 메모리에 저장하고, 실제 변경에 대한 준비가 완료 됐을 때 브라우저의 DOM에 반영한다. → 브라우저와 개발자의 부담을 덜 수 있다.
- 가상 DOM은 대부분의 상황에서 합리적으로 빠르다 → 무조건 빠르다 ❌

<br/>



3. React Fiber
- 파이버란?
    - 리액트에서 관리하는 평범한 자바스크립트 객체
    - 리액트 컴포넌트에 대한 정보를 1:1로 가지고 있음
    - 파이버 재조정자가 가상 DOM과 실제 DOM을 비교해 변경 사항을 수집하고 재조정(reconciliation)한다.
    - 작업을 작은 단위로 분할하고 쪼갠 다음, 우선순위를 매긴다.
    - 작업을 일시중지 하거나 다시 시작할 수 있다.
    - 이전의 작업을 재사용 하거나 폐기할 수 있다. (가급적이면 재사용)
    
    → 이러한 과정은 비동기로 일어난다. 
    
- 파이버 트리
    - 파이버 트리는 현재의 모습을 담은 트리와 작업중인 상태를 나타내는 `wordInProgress` 트리가 존재한다.
    - 리액트 파이버의 작업이 끝나면 포인터만 변경해 `wordInProgress` 트리를 현재 트리로 바꾼다 (더블 버퍼링)
    - 가급적 기존의 파이버를 재사용하여 반복적인 재조정을 효율적으로 하여 트리를 업데이트 한다.
- 트리 업데이트 과정을 동기식으로 한다면, 렌더링 작업이 끝날때까지 다른 작업을 수행하지 못하게 되고 사용자 인터렉션에 좋지 않다.(사용자를 기다리게함)
- fiber 아키텍처는 작업을 작은 조각으로 분할하여 우선순위를 부여하고, 브라우저의 메인 스레드가 렌더링 작업을 중단하지 않고도 다른 작업을 수행할 수 있도록 한다. → 동작을 나눠서 하게 함으로써 지연 되었던 인터랙션을 빨리 할 수 있음

<br/>


4. 파이버와 가상DOM
- 파이버의 비동기 작업과 달리 실제 브라우저 구조인 DOM에 반영하는 것은 동기적으로 일어나야 함
- 처리하는 작업이 많아질수록 화면에 불안전하게 표시될 수 있는 가능성이 높기 때문에 메모리 상에서 먼저 작업을 수행하여 최종적인 결과물을 실제 DOM에 적용한다.
