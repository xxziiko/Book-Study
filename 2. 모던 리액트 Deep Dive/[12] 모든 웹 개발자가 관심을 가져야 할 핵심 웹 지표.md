### 1. 웹사이트와 성능

- 웹사이트는 방문한 목적을 손쉽게 달성할 수 있어야 하고, 이 목적을 달성하는 데 걸리는 시간이 짧아야 하며 개인정보가 누출되는 등과 같은 사고가 없이 보안이 철저해야 한다.
- 과거에 비해 비교할 수 없이 모바일 기기의 성능이 향상 됐으며, 네트워크 속도 또한 빨라졌음에도 여전히 대다수의 웹사이트 방문객들은 속도에 민감하며 느린 속도에 불만을 가짐
- 과거 웹사이트의 성능은 단순히 웹사이트의 속도, 방문이나 결제 같은 실제 목표로 이루어지는 전환율 등으로만 판단
- 구글은 핵심 웹 지표라고 하는 웹사이트의 우수한 사용자 경험을 제공하는데 필요한 몇가지 핵심적인 요소를 꼽고, 이에 대한 지표를 제시

### 2. 핵심 웹 지표란?

- 구글에서 핵심 웹 지표로 꼽는 지표
    - 최대 콘텐츠풀 페인트(LCP)
    - 최초 입력 지연(FID)
    - 누적 레이아웃 이동(CLS)
- 다음 두 지표는 특정 문제를 진단하는 데 사용
    - 최초 바이트까지의 시간(TTFB)
    - 최초 콘텐츠풀 시간(FCP)

### 3. 최대 콘텐츠풀 페인트(LCP)

- 페이지가 처음으로 로드를 시작한 시점부터 뷰포트 내부에서 가장 **큰 이미지 또는 텍스트**를 렌더링 하는 데 걸리는 시간
- 뷰포트: 사용자에게 현재 노출되는 화면
- **큰 이미지 또는 텍스트**
    - <img>
    - <svg> 내부의 <image>
    - url()을 통해 불러온 배경 이미지가 있는 요소
    - 텍스트와 같이 인라인 텍스트 요소를 포함하고 있는 블록 레벨 요소
        - 이 블록 레벨 요소에는 <p>, <div>등이 포함
- 즉, 최대 콘텐츠풀 페인트란 사용자의 기기가 노출하는 뷰포트 내부에서 가장 큰 영역을 차지하는 요소가 렌더링을 하는 시간을 측정하는 지표
- 사용자에게 있어 로딩이란 일단 뷰포트 영역에 보이는 부분을 기준으로 함. 사용자에게 노출되는 부분만 로딩돼 있다면 사용자는 페이지 로딩이 완료됐다고 느낄 것
- 사용자에게 페이지의 정보를 화면에 전달하는 속도를 객관적으로 판단하기 위한 지표로 만들어진 것이 최대 콘텐츠풀 페인트(LCP)
- LCP에서 좋은 점수는 해당 지표가 2.5초 내로 응답이 오는것
- 점수를 높일 수 있는 방법
    - 뷰포트 최대영역에 이미지가 아닌 문자열을 넣는 것.
        
         → 아무리 이미지를 최적화하더라도 추가적인 리소스 다운로드가 필요한 이미지보다 텍스트 노출이 훨씬 빠르다
        
    - background-image보다 <img>를 사용하는 것이 좋다.
        - CSS에 있는 리소스는 항상 느리다. 브라우저가 해당 리소스를 필요로 하는 DOM을 그릴 준비가 될 때 까지 리소스 요청을 뒤로 미루기 때문
- 유의할 점
    - `loading=lazy` 주의: 리소스를 중요하지 않음으로 표시하고 필요할 때만 로드하는 전략으로, <img>나 <iframe>등에 적용할 수 있지만 중요하지 않은 리소스로 분류되면 안됨. → 그저 로딩 속도만 늦출 뿐 지표 점수에는 도움이 되지 않음
    - 클라이언트에서 빌드하지 말 것: 서버에서 빌드해온 HTML을 프리로드 스캐너가 바로 읽어서 최대 콘텐츠풀 페인트로 빠르게 빠져나가는 것이 최적의 시나리오
    - 최대 콘텐츠풀 리소스는 직접 호스트: 가능하면 직접 도메인에서 호스팅하는 것이 좋다. 일반적으로 이미지 최적화 서비스를 사용해 이미지를 가져오는 것은 최적화에 좋은 영향을 미치지 않는다. 왜냐하면 새로운 출처의 경우에 네트워크 커넥션부터 다시해야 하기 때문. 중요한 리소스는 직접 다루고 덜 중요한 리소스에 대해서만 이미지 최적화 서비스를 사용하는 식으로 관리하는 것이 좋다.

### 4. 최초 입력 지연(FID)

- 화면이 최초에 그려지고 난 뒤, 사용자가 웹페이지에서 클릭 등 상호작용을 수행했을 때 메인 스레드가 이 이벤트에 대한 반응을 할 수 있을 때까지 걸리는 시간
- 얼마나 빠르게 웹페이지와의 상호작용에 대한 응답을 받을 수 있는지 측정하는 지표
- 모든 입력이 아닌 최초의 입력 하나에 대해서만 그 응답 지연이 얼마나 걸리는지 판단
- 지연이 발생하는 이유: 메인스레드가 대규모 렌더링이나 자바스크립트 파일 실행 등의 다른 작업으로 인해 리소스를 할애하고 있을 때, 싱글스레드인 자바스크립트가 이벤트 리스너와 같은 다른 작업을 실행할 수 없기 때문에 지연이 발생한다.
- 100ms이내로 응답이 오면 좋은 점수를 받고, 300ms 이내인 경우 보통, 그 이후는 나쁨으로 처리
- 개선 방안
    - 실행에 오래걸리는 긴 작업을 분리하자
    - 자바스크립트의 코드를 최소화 하자
        - 당장에 급하지 않은 코드들은 지연로딩 기법등을 사용하여 우선순위를 낮춰 불러오는 것이 좋다
    - 타사 자바스크립트 코드 실행의 지연
        - <script>의 async와 defer를 이용해 지연 불러오기를 하는 것이 좋음
        - 광고와 같이 실제 사용자의 뷰포트 위치에 따라 불러와야 하는 컴포넌트라면 Intersection Observer를 이용해 뷰포트에 들어오는 시점에 불러오는 것이 좋다

### 5. 누적 레이아웃 이동(CLS)

- 페이지의 생명주기 동안 발생하는 모든 예기치 않은 이동에 대한 지표를 계산하는 것
- 누적 레이아웃 이동은 사용자의 가시적인 콘텐츠에 영향을 미쳐야 하기 때문에 뷰포트 내부의 요소에 대해서만 측정
- 최초 렌더링이 시작된 위치에서 만약 레이아웃의 이동이 발생했다면 기록
- 사용자 액션으로 인해 발생한 레이아웃 이동은 점수에 포함되지 않음
- 미리 노출이 예상되는 부분을 HTML로 자리 잡아 두는 것이 누적 레이아웃 지표에 큰 도움이 된다. 콘텐츠가 어떤 방식으로 렌더링 될지 안정적인 예측이 가능하며 내부 레이아웃의 큰 이동이나 불편을 겪지 않아도 되기 때문
- 개선 방안
    - 삽입이 예상되는 요소를 위한 추가적인 공간 확보
        - useEffect의 내부에서 요소를 미치는 작업, 특히 뷰포트 내부에서 노출 될 확률이 높은 작업을 최소화
        - 서버사이드렌더링이 가장 좋은 방법. 서버에서 이러한 동적인 요소의 유무를 사전에 판단해 클라이언트에 HTML을 미리 제공해 준다면 클라이언트에서 깔끔하게 처리
    - 폰트 로딩 최적화
    - 적절한 이미지 크기 설정

### 6. 성능 확인에 중요한 지표들

1. 최초 바이트까지의 시간(TTFB)
    - 브라우저가 웹페이지의 첫 번째 바이트를 수신하는데 걸리는 시간
    - 최초의 응답이 오는 바이트까지가 얼마나 걸리는지를 측정, 600ms 이상 걸릴 경우 개선이 필요한 것으로 간주
    - 서버 사이드 렌더링을 하고 있는 애플리케이션에서 주의 깊게 봐야 할 지표. 첫 번째 HTML을 만들기 위해 작업이 많거나 느릴수록 최초 바이트까지의 시간이 길어지게 된다. 따라서 로직을 최적화해 페이지를 최대한 빨리 준비시켜야 한다.
2. 최초 콘텐츠풀 페인트(FCP)
    - 페이지가 로드되기 시작한 시점부터 페이지 콘텐츠의 일부가 화면에 렌더링될 때까지의 시간을 측정
    - 개선 방안
        - 최초 바이트까지의 시간(TTFB) 개선
        - 렌더링을 가로막는 리소스 최소화: CSS 같은 렌더링을 가로막는 리소스를 최소화하고, 렌더링을 방해하는 리소스를 비동기적으로 로드
        - Above the Fold에 대한 최적화
        - 페이지 리다이렉트 최소화
        - DOM 크기 최소화
